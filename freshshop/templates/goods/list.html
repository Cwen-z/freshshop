{% extends 'base.html' %}
{% block head %}
    <script>

    $(function () {
        $.get('/cart/cart_nums/',function (data) {
            var nums = data.status
            if (nums != 0){
                $('#show_count').text(nums)
            }
            else{
                $('#show_count').text(0)
            }
        })
    })
    </script>
{% endblock head %}
{% block body %}
	<div class="navbar_con">
		<div class="navbar clearfix">
			<div class="subnav_con fl">
				<h1>全部商品分类</h1>	
				<span></span>			
				<ul class="subnav">
					<li><a href="/goods/{{ type.0.id }}/1/1" class="fruit">{{ type.0.title }}</a></li>
                    <li><a href="/goods/{{ type.1.id }}/1/1" class="seafood">{{ type.1.title }}</a></li>
                    <li><a href="/goods/{{ type.2.id }}/1/1" class="meet">{{ type.2.title }}</a></li>
                    <li><a href="/goods/{{ type.3.id }}/1/1" class="egg">{{ type.3.title }}</a></li>
                    <li><a href="/goods/{{ type.4.id }}/1/1" class="vegetables">{{ type.4.title }}</a></li>
                    <li><a href="/goods/{{ type.5.id }}/1/1" class="ice">{{ type.5.title }}</a></li>
				</ul>
			</div>
			<ul class="navlist fl">
				<li><a href="/">首页</a></li>
				<li class="interval">|</li>
				<li><a href="javascript:;">手机生鲜</a></li>
				<li class="interval">|</li>
				<li><a href="javascript:;">抽奖</a></li>
			</ul>
		</div>
	</div>

	<div class="breadcrumb">
		<a href="/">全部分类</a>
		<span>></span>
		<a href="/goods/{{ type1.id }}/1/1">{{ type1.title }}</a>
	</div>

	<div class="main_wrap clearfix">
		<div class="l_wrap fl clearfix">
			<div class="new_goods">
				<h3>新品推荐</h3>
				<ul>
					{% for gd_news in news %}
					<li>
						<a href="/goods/{{ gd_news.id }}"><img src="/static/media/{{ gd_news.gpic }}"></a>
						<h4><a href="/goods/{{ gd_news.id }}">{{ gd_news.gtitle }}</a></h4>
						<div class="prize">￥{{ gd_news.gprice }}</div>
					</li>
					{% endfor %}
				</ul>
			</div>
		</div>

		<div class="r_wrap fr clearfix">
			<div class="sort_bar">
				<a href="/goods/{{ type1.id }}/1/1"
                {% if sort == 1 %}
                        class="active"
                   {% endif %}
                >默认</a>
				<a href="/goods/{{ type1.id }}/2/1"
                {% if sort == 2 %}
                        class="active"
                   {% endif %}
                >价格</a>
				<a href="/goods/{{ type1.id }}/3/1"
                {% if sort == 3 %}
                        class="active"
                   {% endif %}
                >人气</a>
			</div>

			<ul class="goods_type_list clearfix">
                {% for goods in page %}
				<li>
					<a href="/goods/{{ goods.id }}"><img src="/static/media/{{ goods.gpic }}"></a>
					<h4><a href="/goods/{{ goods.id }}">{{ goods.gtitle }}</a></h4>
					<div class="operate">
						<span class="prize">￥{{ goods.gprice }}</span>
						<span class="unit">{{ goods.gunit }}</span>
						<a href="javascript:;" class="add_goods" title="加入购物车"></a>
                        <span hidden>{{ goods.id }}</span>
					</div>
				</li>
                {% endfor %}
            </ul>

			<div class="pagenation">
                {% if page.has_previous %}
                    <a href="/goods/{{ type1.id }}/{{ sort }}/{{ page.previous_page_number }}">上一页</a>
                {% endif %}
                {% for pn in paginator.page_range %}
                    {% if pn == page.number %}
                    <a href="#" class="active">{{ pn }}</a>
                    {% else %}
                    <a href="/goods/{{ type1.id }}/{{ sort }}/{{ pn }}">{{ pn }}</a>
                    {% endif %}
                {% endfor %}
                {% if page.has_next %}
                    <a href="/goods/{{ type1.id }}/{{ sort }}/{{ page.next_page_number }}">下一页></a>
                {% endif %}

			</div>
		</div>
	</div>
{% endblock body %}

    {% block foot %}
    <div class="add_jump"></div>
	<script type="text/javascript">
		var $add_x = $('.goods_count').offset().top;
		var $add_y = $('.goods_count').offset().left;

		var $to_x = $('#show_count').offset().top;
		var $to_y = $('#show_count').offset().left;


		$('.add_goods').click(function() {
            $(".add_jump").css({'left':$add_y+80,'top':$add_x+10,'display':'block'})
            if ($('.login_btn').text().indexOf('登录') >= 0) {
                alert("悟空，记得要先登录，后购买");
                location.href = '/users/login/';
                return
            }
            $(".add_jump").stop().animate({
                    'left': $to_y + 7,
                    'top': $to_x + 7
                },
                "fast", function () {
                    $(".add_jump").fadeOut('fast', function () {
                    });
                });
            gid = $(this).next('span').html()
            $.get('/cart/add_cart/' + gid + '_1', function (data) {
                value = data.counts;
                $('#show_count').text(value);
            })
        })
	</script>
    {% endblock%}